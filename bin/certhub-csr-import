#!/bin/sh

set -e
set -u

# Required binaries
ECHO=/bin/echo
MKDIR=/bin/mkdir
MV=/bin/mv

# Print usage message and exit.
usage() {
    ${ECHO} "${0}: /path/to/certhub/instance.example.com csr.pem [ssl.cnf]"
    return 1
}

certhub_csr_import() {
    INSTANCE_DIR="${1}"
    CSR_PATH="${INSTANCE_DIR}/${CERTHUB_CSR_NAME:-csr.pem}"
    CNF_PATH="${INSTANCE_DIR}/${CERTHUB_CNF_NAME:-ssl.cnf}"

    if [ ! -e "${INSTANCE_DIR}" ]; then
        ${MKDIR} "${INSTANCE_DIR}"
    fi

    ${MV} "${2}" "${CSR_PATH}"

    if [ -n "${3}" ]; then
        ${MV} "${3}" "${CNF_PATH}"
    fi
}

if [ "${#}" -gt 1 ] && [ "${1:-}" != "-h" ] && [ "${1:-}" != "--help" ]; then
    certhub_csr_import "${@}"
else
    usage
fi
